<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8" />
        <title>自定义工具栏 - Editor.md examples</title>
        <link rel="stylesheet" href="css/styles.css" />
        <link rel="stylesheet" href="css/editormd.css" />
        <link rel="shortcut icon" href="https://pandao.github.io/editor.md/favicon.ico" type="image/x-icon" />
<!--         <link href="../dist/stylesheets/user/thinker-md.user.min.css" rel="stylesheet">
        <link href="../dist/stylesheets/vendor/thinker-md.min.css" rel="stylesheet">
        <script src="../dist/javascripts/vendor/jquery-2.1.3.js" type="text/javascript"></script>
        <script src="../dist/javascripts/vendor/thinker-md.js" type="text/javascript"></script> -->
    </head>
    <body>
        <div class="btns">
            <button id="get-html-btn">Get HTML</button>
            <button id="get-md-btn">Get md</button>
            <button id="get-value">Get md</button>
        </div>
        <div id="layout">
            <form action="http://editormd.ipandao.com/php/post.php" method="post">
                <div class="editormd" id="test-editormd">
                    <textarea id='the_mark'>### Hello world!</textarea>
                </div>
                <br/><input type="submit" name="submit" value="Submit" class="btn" style="margin-left: 5%;" />
            </form>
        </div>
        <div id="test-editormd-view2">
            <textarea id="append-test" style="display:none;">
                # XCTF社区

XCTF社区是白帽子与安全极客的交流社区，为CTFer和行业用户提供全行业赛事信息，搭建竞赛交流平台，促进安全人才和企业的沟通，同时也是XCTF联赛线上服务平台。

## 安装及配置

```
pip install -r requirements.txt
```

### 配置项说明
```
[system]
debug = False               #是否启用debug模式（此模式下django会默认帮住处理静态文件）

#数据库配置
DATABASES = {
    'default': {            #默认启用的配置方案
        'ENGINE': 'django.db.backends.mysql',       #默认数据引擎
        'NAME': 'community_bj_dev',                 #数据库名称
        'USER': 'cpbjdev',                          #数据库链接用户名
        'PASSWORD': 'cpbj456^789(',                 #数据库链接密码
        'HOST': '192.168.1.250',                    #数据库服务器地址
        'PORT': '3306',                             #数据库服务器端口
    },
}

# Email服务相关配置,各参数参照邮件服务提供商参考配置
EMAIL_HOST = 'smtp.exmail.qq.com'
EMAIL_PORT = 465
EMAIL_HOST_USER = 'webmaster@xctf.org.cn'
EMAIL_HOST_PASSWORD = 'master@mai2014,l'
EMAIL_USE_SSL = True
DEFAULT_FROM_EMAIL = 'webmaster@xctf.org.cn'
EMAIL_SUBJECT_PREFIX = '[Community]'
SERVER_EMAIL = 'webmaster@xctf.org.cn'


# 允许访问当前项目的ip范围
ALLOWED_HOSTS = ['*']

# django启动时加载的模块
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'template',
    'ctfchina',
    'customauth.apps.CustomauthConfig',
    'web.apps.WebConfig',
    'custom_admin.apps.CustomAdminConfig',
    'django_extensions',
    'cas',
]

# 中间件配置
MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.locale.LocaleMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    # 'web.middleware.MaintenanceMiddleware',
    'web.middleware.AdletMiddleware',
    'web.middleware.EventLiveStatusMiddleware',
    # 'web.middleware.DailyLoginMiddleware',
    # for django-debug-toolbar
    # 'debug_toolbar.middleware.DebugToolbarMiddleware',
]

# 用户认证校验方法
AUTHENTICATION_BACKENDS = (
    'cas.backends.CASBackend',
    'django.contrib.auth.backends.ModelBackend',
)

# 单点认证相关配置
CAS_RESPONSE_CALLBACKS = ['cas.callback.community_callback', ]
CAS_SERVER_URL = "https://account.xctf.org.cn/cas/login"
CAS_LOGOUT_COMPLETELY = "https://account.xctf.org.cn/cas/logout"
CAS_IGNORE_REFERER = True
CAS_REDIRECT_URL = '/'
CAS_AUTO_CREATE_USER = True

![CSDN图标](http://f12.baidu.com/it/u=292560263,2120845313&fm=76"这是CSDN的图标")

## 使用

### 用于演示目的
python manage.py runserver 0.0.0.0:port
在成功启动后，请使用http://ip:port的地址访问后台管理页面。
            </textarea>
        </div>
    </body>
</html>

        <script src="js/jquery.min.js"></script>
        <script src="js/zepto.min.js"></script>
        <script src="js/editormd.js"></script>
        <!--获取html-->
        <script src="lib/marked.min.js"></script>
        <script src="lib/prettify.min.js"></script>
        <script src="lib/raphael.min.js"></script>
        <script src="lib/underscore.min.js"></script>
        <script src="lib/sequence-diagram.min.js"></script>
        <script src="lib/flowchart.min.js"></script>
        <script src="lib/jquery.flowchart.min.js"></script>
        <!-- 多语言和自定义工具栏的整合测试 -->
        <script src="js/en.js"></script>
        <script type="text/javascript">
            $(function() {
                var testEditor = editormd("test-editormd", {
                    width: "90%",
                    height: 640,
                    path : 'lib/',//文件引用路径
                    saveHTMLToTextarea : true,//开启转换markdown转换为html
                    watch : true,//初始化开始实时监控
                    placeholder:'输入内容……',//编辑器默认没有文字时提示
                    imageUpload : true,//开启上传图片
                    imageFormats : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],//图片格式
                    imageUploadURL : "./php/upload.php?test=dfdf",//上传图片后台url
                    //上传图片弹框位置固定
                    dialogLockScreen:false,
                    //编辑器编译HTML代码
                    htmlDecode : true,
                    //自定义工具栏按钮
                    toolbarIcons : function() {
                        // Or return editormd.toolbarModes[name]; // full, simple, mini
                        // Using "||" set icons align right.
                        return ["bold","italic", "|","quote","code","list-ul","list-ol", "|",  "preview", "watch", "|", "fullscreen", "testIcon", "testIcon2", "image" ,"file", "faicon", "||"]
                    },
                    // toolbarIcons : "full", // You can also use editormd.toolbarModes[name] default list, values: full, simple, mini.
                    toolbarIconsClass : {
                        testIcon : "fa-gears"  // 指定一个FontAawsome的图标类
                    },
                    toolbarIconTexts : {
                        testIcon2 : "测试按钮Test button"  // 如果没有图标，则可以这样直接插入内容，可以是字符串或HTML标签
                    },

                    // 用于增加自定义工具栏的功能，可以直接插入HTML标签，不使用默认的元素创建图标
                    toolbarCustomIcons : {
                        // file   : "<input type=\"file\" accept=\".md\" />",
                        file   : "<input type=\"file\" />",
                        // faicon : "<i class=\"fa fa-star\" onclick=\"alert('faicon');\"></i>"
                    },

                    // 自定义工具栏按钮的事件处理
                    toolbarHandlers : {
                        /**
                         * @param {Object}      cm         CodeMirror对象
                         * @param {Object}      icon       图标按钮jQuery元素对象
                         * @param {Object}      cursor     CodeMirror的光标对象，可获取光标所在行和位置
                         * @param {String}      selection  编辑器选中的文本
                         */
                        testIcon : function(cm, icon, cursor, selection) {

                            //var cursor    = cm.getCursor();     //获取当前光标对象，同cursor参数
                            //var selection = cm.getSelection();  //获取当前选中的文本，同selection参数

                            // 替换选中文本，如果没有选中文本，则直接插入
                            cm.replaceSelection("[" + selection + ":testIcon]");

                            // 如果当前没有选中的文本，将光标移到要输入的位置
                            if(selection === "") {
                                cm.setCursor(cursor.line, cursor.ch + 1);
                            }

                            // this == 当前editormd实例
                            console.log("testIcon =>", this, cm, icon, cursor, selection);
                        },

                        testIcon2 : function(cm, icon, cursor, selection) {
                            cm.replaceSelection("[" + selection + ":testIcon2](" + icon.html() + ")");
                            console.log("testIcon2 =>", this, icon.html());
                        }
                    },
                    //自定义工具栏按钮的提示语言
                    lang : {
                        toolbar : {
                            file : "上传文件",
                            testIcon : "自定义按钮testIcon",  // 自定义按钮的提示文本，即title属性
                            testIcon2 : "自定义按钮testIcon2",
                            undo : "撤销 (Ctrl+Z)",
                            bold : "粗体",
                            italic : "斜体",
                        }
                    },

                    onload : function(){
                        //这里可以编写文件上传访问后台成功后的函数
                        $("[type=\"file\"]").bind("change", function(){
                            alert($(this).val());
                            //获取到内容添加到编辑器中
                            testEditor.cm.replaceSelection($(this).val());
                            console.log($(this).val(), testEditor);
                        });
                    }
                });
                $("#get-md-btn").bind('click', function(){
                    alert(testEditor.getMarkdown());
                });
                $("#get-html-btn").bind('click', function() {
                    alert(testEditor.getHTML());
                });
                $("#get-value").bind('click', function() {
                    alert($('#the_mark').val());
                });
                //静态页面拿到markdown内容可以直接编译成html
                $(function() {
                    var testEditormdView, testEditormdView2;

                    testEditormdView2 = editormd.markdownToHTML("test-editormd-view2", {
                        htmlDecode      : "style,script,iframe",  // you can filter tags decode
                        emoji           : true,
                        taskList        : true,
                        tex             : true,  // 默认不解析
                        flowChart       : true,  // 默认不解析
                        sequenceDiagram : true,  // 默认不解析
                    });
                });

            });
        //设置markdown内容
        var md="# Email服务相关配置,各参数参照邮件服务提供商参考配置";
       $("#the_mark").text(md);
       //上传图片后台只需要返回如下面的json格式即可
       // {
       //  success : 0 | 1, //0表示上传失败;1表示上传成功
       //  message : "提示的信息",
       //  url     : "图片地址" //上传成功时才返回
       // }
        </script>
    </body>
</html>